<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no">

<title>suixin dictation helper</title>

<script type="text/javascript"> 

function trim(str)
{
 str = str.replace(/(^\s*)|(\s*$)/g, "");
 
 str = str.replace(/(^\n*)|(\n*$)/g, "");
 
 return str;
}
		
function getDictationContentJSON()
{
	var dictationContent = document.getElementById('dictationContent').value;
	
	dictationContent = trim(dictationContent);
	
	dictationContent = dictationContent.replace(/([.\n\r]+)/g,"\n");
		  
	var content = dictationContent.split("\n");
			  
	var jsonContent = '{"words":[';
		  
	jsonContent += '{"word":"听写开始"},';	
	
	for(var i=0;i<content.length;i++)
	{
	  if(content[i]!="")
	  {
	    jsonContent += '{"word":"'+content[i]+'"},';
	  }			
	}	  

    jsonContent += '{"word":"听写结束"}';
	jsonContent += ']}';
		  
		  
		  
	return jsonContent;
	}
		

var intervalRef = null;
		
function dictation()
{

  var dictationBtn = document.getElementById("dictationBtn");
  var stopDictationBtn = document.getElementById("stopDictationBtn");
  
  dictationBtn.disabled = true;
  stopDictationBtn.disabled = false;

  var wordToDict = document.getElementById("wordToDict");
  
  wordToDict.style= "background-color:green;color:white;";
  
  var inf = document.getElementById("inf");
  inf.innerHTML = "正在听写：";
  
  var ttsText = document.getElementById("ttsText");
  
  ttsText.style="border:0;border-bottom:2px;border-bottom-style:solid;border-bottom-color:black;text-align:center;";

  var jsonstr = getDictationContentJSON();	
  
  var obj = JSON.parse(jsonstr);
		  
  var i = 0;
	

  var oneWordRepeatTimes = parseInt(document.getElementById("repeatTimes").value);  
  
  var hintRepeatTimes = parseInt(document.getElementById("hintRepeatTimes").value);  
  		  		  
  var oneWordRepeatCount = oneWordRepeatTimes;
  
  var hintRepeatTimesCount =  hintRepeatTimes;
  
  intervalRef = setInterval(function(){
  
		   
  if(i>0&&i<(obj.words.length-1)&&oneWordRepeatCount>0)
  {
    document.getElementById('ttsText').value= obj.words[i].word;
	doTTS();
	oneWordRepeatCount--;
			  	  
  }
  else if(i>0&&i<(obj.words.length-1)&&oneWordRepeatCount<=0)
  {
        
	i++;
	if(i<(obj.words.length-1))	
	{
	
	  oneWordRepeatCount = oneWordRepeatTimes;	
			
  	  document.getElementById('ttsText').value= obj.words[i].word;
	  doTTS();
      oneWordRepeatCount--;
	 }	
		  
   }
   
  
  
  if(i==0&&hintRepeatTimesCount>0)//必须放到上面代码之后,不然i的自增会影响上面逻辑
  {
    document.getElementById('ttsText').value= obj.words[i].word;
	
	doTTS();
	hintRepeatTimesCount--;
	
	if(hintRepeatTimesCount==0)
	{
	  i++;
	  hintRepeatTimesCount =  hintRepeatTimes;	
	}	
  }
  else if(i==0&&hintRepeatTimes==0)
  {
    i++;
  }
  
  if(i==(obj.words.length-1)&&hintRepeatTimesCount>0)
  {
    document.getElementById('ttsText').value= obj.words[i].word;
	doTTS();
	hintRepeatTimesCount--;  
	
	if(hintRepeatTimesCount==0)
	{
	  stopDictation();	
	}
  } 
  else if(i==(obj.words.length-1)&&hintRepeatTimes==0)
  {
    stopDictation();
  }
			
  },4000);			 
		  		  
  }
  
function stopDictation()
{

    clearInterval(intervalRef);
	
    var wordToDict = document.getElementById("wordToDict");
  
    wordToDict.style= "background-color:#0033FF;color:white;";
  
    var inf = document.getElementById("inf");
    inf.innerHTML = "欢迎使用听写助手";
  
    var ttsText = document.getElementById("ttsText");
	
	ttsText.value = "";
  
    ttsText.style="display:none;";
	
    var dictationBtn = document.getElementById("dictationBtn");
    var stopDictationBtn = document.getElementById("stopDictationBtn");
  
    dictationBtn.disabled = false;
    stopDictationBtn.disabled = true; 
  
}
		
function doTTS()
{

  var ttsDiv = document.getElementById('bdtts_div_id');
  var ttsAudio = document.getElementById('tts_autio_id');
  var ttsText = document.getElementById('ttsText').value;
			
  ttsDiv.removeChild(ttsAudio);
  var au1 = '<audio id="tts_autio_id" autoplay="autoplay" />';
  var sss = '<source id="tts_source_id" src="http://tts.baidu.com/text2audio?lan=zh&ie=UTF-8&spd=5&text='+ttsText+'" type="audio/mpeg" />';
  var eee = '<embed id="tts_embed_id" height="0" width="0" src="" />';
  var au2 = '</audio>';
  ttsDiv.innerHTML = au1 + sss + eee + au2;
			
  ttsAudio = document.getElementById('tts_autio_id');
			
  ttsAudio.play();
}
</script>
</head>

<body>

<div id="container" style="text-align:center">

<div id="wordToDict" style="background-color:#0033FF;color:white;"><span id="inf">欢迎使用听写助手</span><input style="display:none;" type="text" id="ttsText" value="" /></div>
<hr style="border-color:#0033FF" />
<div id="bdtts_div_id">	
<audio id="tts_autio_id" autoplay="autoplay" />
<source id="tts_source_id" src="http://tts.baidu.com/text2audio?lan=zh&ie=UTF-8&spd=5&text=你好,欢迎使用听写助手" type="audio/mpeg" />
<embed id="tts_embed_id" height="0" width="0" src="" />
</audio>	
</div>
		
<div>
<form id="dictationContentForm" name="dictationContentForm">
请输入听写内容<br /><br />
<textarea rows="23" cols="28" id="dictationContent" name="dictationContent"></textarea>
<br />
<input type="button" id="dictationBtn" size="20" value="开始听写" onClick="dictation()" />
&nbsp;
<input type="button" id="stopDictationBtn" size="20" disabled="disabled" value="停止听写" onClick="stopDictation()" />
</form>
</div>
<div>
<hr style="border-color:#0033FF" />

<select id="hintRepeatTimes"><option value="0">提示重复0次</option><option value="1" selected="selected">提示重复1次</option><option value="2">提示重复2次</option><option value="3">提示重复3次</option></select>&nbsp;

<select id="repeatTimes"><option value="1">正文重复1次</option><option value="2">正文重复2次</option><option value="3" selected="selected">正文重复3次</option><option value="4">正文重复4次</option><option value="5">正文重复5次</option><option value="6">正文重复6次</option></select>

</div>
<div style="background-color:#0033FF;color:#CCCCCC; margin-top:5px;">
<div style="text-align:center">使用说明</div>
<div style="text-align:left;padding:10px;">
1、语文、英语均可听写；<br /><br />
2、听写前先输入想听写的单词，可以让孩子自己录入，强化记忆；<br /><br />
3、每个听写单元占一行，如想分别听写hello, world两个单词，那么在hello之后换行，如果想两个单词作为一个单元连读,则让这两个单词在一行即可。<br /><br />
4、如果因为语句过长导致自然换行，目前只会读出第一行,所以建议每行不要太长,下一版本计划加以改进。
<br /><br />
5、听写开始和结束时，会有对应重复次数的听写开始和结束的提示，请耐心等待。
</div>
</div>

<div style="display:none"><script src="https://s13.cnzz.com/z_stat.php?id=5808247&web_id=5808247" language="JavaScript"></script></div>
</div>
</body>
</html>
